#!/usr/bin/env java org.mozilla.javascript.tools.shell.Main

load("core.js");

require("lib/roundabout");
require("lib/jack/lobster");

Roundabout.GET("/", function() {
    return "hello world!";
});

Roundabout.GET("/asdf", new Jack.Lobster("asdf"));

Roundabout.route({
    path: "/hello/*",
    GET: function() {
        this.redirect("http://"+this.wildcards[0]);
    },
    POST: function() {
        this.redirect("/");
    },
    filter: function() {
        return true;//Math.random() > 0.5;
    }
});

Roundabout.GET("/*/{asdf}", function() {
    //this.response.write("Hello " + this.wildcards[0] + " and " + this.wildcards["asdf"] + "\n");
    var gets = this.request.GET();
    for (var i in gets) {
        this.response.write(i + " => " + gets[i] + "\n");
    }
});

Roundabout.GET("/hello", function(env) {
	var req = new Jack.Request(env);
	var name = req.GET()["name"];
	
	var resp = new Jack.Response();
	resp.setHeader("Content-Type", "text/plain");
	resp.write("hello "+name+"!");
	return resp.finish(); // equivalent to returning [200, {"Content-Type" : "text/plain"}, "hello "+name+"!"]
});

Roundabout.GET("/hello1", function() {
	var name = this.request.GET()["name"];
	this.header("Content-Type", "text/plain");
	this.body("hello "+name+"!");
});

Roundabout.run();
